<!DOCTYPE html>
<html>
<head>
    <title>HealthSync Dashboard</title>
    <style>
        body { font-family: Arial; padding: 20px; max-width: 800px; margin: 0 auto; }
        .card { background: #f5f5f5; padding: 20px; margin: 15px 0; border-radius: 8px; }
        .success { color: green; }
        .error { color: red; }
        .loading { color: blue; }
        input, button { padding: 10px; margin: 5px; font-size: 16px; }
        button { background: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background: #45a049; }
    </style>
</head>
<body>
    <h1>Ìø• HealthSync Dashboard</h1>
    
    <div class="card">
        <h3>API Status: <span id="status" class="loading">Checking...</span></h3>
    </div>
    
    <div class="card">
        <h3>Analytics</h3>
        <p>Patients: <span id="patients">0</span></p>
        <p>Avg Risk: <span id="avgRisk">0.0</span></p>
        <p>Alerts: <span id="alerts">0</span></p>
        <button onclick="loadAnalytics()">Refresh</button>
    </div>
    
    <div class="card">
        <h3>Make Prediction</h3>
        Age: <input type="number" id="age" value="65" min="1" max="120">
        BP: <input type="number" id="bp" value="120" min="50" max="250">
        <button onclick="makePrediction()">Predict</button>
        <div id="result"></div>
    </div>
    
    <script>
        const API_URL = 'http://localhost:8001';
        
        // Check API status on load
        checkAPI();
        
        async function checkAPI() {
            try {
                const response = await fetch(API_URL + '/health');
                if (response.ok) {
                    document.getElementById('status').className = 'success';
                    document.getElementById('status').textContent = '‚úÖ Online';
                    loadAnalytics();
                } else {
                    throw new Error('API not responding');
                }
            } catch (error) {
                document.getElementById('status').className = 'error';
                document.getElementById('status').textContent = '‚ùå Offline: ' + error.message;
            }
        }
        
        async function loadAnalytics() {
            try {
                const response = await fetch(API_URL + '/analytics');
                const data = await response.json();
                
                document.getElementById('patients').textContent = data.total_patients;
                document.getElementById('avgRisk').textContent = data.avg_risk_score;
                document.getElementById('alerts').textContent = data.active_alerts;
                
            } catch (error) {
                console.error('Analytics error:', error);
            }
        }
        
        async function makePrediction() {
            const age = document.getElementById('age').value;
            const bp = document.getElementById('bp').value;
            
            if (!age || !bp) {
                alert('Please enter both values');
                return;
            }
            
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p class="loading">Predicting...</p>';
            
            try {
                const response = await fetch(API_URL + '/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        age: parseInt(age),
                        systolic_bp: parseInt(bp)
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <p class="success"><strong>‚úÖ Prediction Complete</strong></p>
                        <p>Risk Score: ${data.risk_score}</p>
                        <p>Risk Level: ${data.risk_level}</p>
                        <p>Age: ${data.age}, BP: ${data.bp}</p>
                    `;
                } else {
                    resultDiv.innerHTML = `<p class="error">Prediction failed</p>`;
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">Error: ${error.message}</p>`;
                console.error('Prediction error:', error);
            }
        }
    </script>
</body>
</html>
